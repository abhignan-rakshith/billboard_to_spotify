Future<void> _loginToSpotify() async {
    setState(() {
      _isLoading = true;
      _status = 'Opening Spotify login...';
    });

    try {
      // Pass callback for desktop platforms
      final launched = await SpotifyAuthService.startLogin(
        onCodeReceived: (code) {
          // This will be called when the local server receives the code
          _exchangeCodeForToken(code);
        },
      );

      if (launched) {
        setState(() {
          _status = 'Please complete login in browser...\n\nYou will be redirected back to the app automatically.';
        });
      } else {
        setState(() {
          _status = '❌ Failed to open Spotify login';
          _isLoading = false;
        });
      }
    } catch (e) {
      setState(() {
        _status = '❌ Error: $e';
        _isLoading = false;
      });
    }
  }